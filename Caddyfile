:80 {
    # Define o diretório raiz para os ficheiros estáticos
    root * /srv/app

    # --- CORREÇÃO: Colocar os proxies PRIMEIRO ---

    # 1. Tratar o WebSocket (para o chat)
    # (Precisamos disto para o chat funcionar em produção)
    reverse_proxy /api/ws* api:8080

    # 2. Tratar a API REST (para login, treinos, etc.)
    reverse_proxy /api/* api:8080

    # 3. Servir o frontend (SPA)
    # Tenta encontrar o ficheiro, senão devolve o index.html
    try_files {path} /index.html
    file_server

    # Extras
    encode gzip
}